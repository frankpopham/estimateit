
<!-- README.md is generated from README.Rmd. Please edit that file -->

# estimateit

The goal of `estimateit` is to estimate marginal effects using inverse
probability weights generated by
[`weightit`](https://github.com/ngreifer/WeightIt). Effects include the
effect for the treated, the effect for the untreated or control, their
difference, their relative difference, and their odds ratio. As the
previous sentence implies `estimateit` only works with binary exposures
and binary outcomes at present.

## Installation

You can install the development version of `estimateit` from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("frankpopham/estimateit")
```

## Example

This is a basic example which shows you how to solve a common problem:

``` r
## A simple example
library(estimateit)
library(cobalt)
#>  cobalt (Version 4.3.1, Build Date: 2021-03-30 09:50:18 UTC)
library(WeightIt)
library(tidyverse)
#> -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
#> v ggplot2 3.3.5     v purrr   0.3.4
#> v tibble  3.1.6     v dplyr   1.0.7
#> v tidyr   1.1.4     v stringr 1.4.0
#> v readr   2.0.2     v forcats 0.5.1
#> -- Conflicts ------------------------------------------ tidyverse_conflicts() --
#> x dplyr::filter() masks stats::filter()
#> x dplyr::lag()    masks stats::lag()
data("lalonde", package = "cobalt")
W1 <- weightit(treat ~ age + educ + married +
                 re74, data = lalonde,
               method = "ps", estimand = "ATE")
summary(W1)
#>                  Summary of weights
#> 
#> - Weight ranges:
#> 
#>            Min                                   Max
#> treated 1.8403  |--------------------------| 77.2514
#> control 1.0282 ||                             2.2699
#> 
#> - Units with 5 greatest weights by group:
#>                                                 
#>              183     184     185     181     182
#>  treated 12.6485 13.0437 13.5275 20.9793 77.2514
#>              589     296     595     597     580
#>  control  2.1658  2.2065  2.2099  2.2699  2.2699
#> 
#> - Weight statistics:
#> 
#>         Coef of Var   MAD Entropy # Zeros
#> treated       1.644 0.566   0.408       0
#> control       0.221 0.203   0.024       0
#> 
#> - Effective Sample Sizes:
#> 
#>            Control Treated
#> Unweighted  429.    185.  
#> Weighted    409.07   50.16
bal.tab(W1)
#> Call
#>  weightit(formula = treat ~ age + educ + married + re74, data = lalonde, 
#>     method = "ps", estimand = "ATE")
#> 
#> Balance Measures
#>                Type Diff.Adj
#> prop.score Distance  -0.1688
#> age         Contin.  -0.1062
#> educ        Contin.   0.1938
#> married      Binary   0.0340
#> re74        Contin.   0.5336
#> 
#> Effective sample sizes
#>            Control Treated
#> Unadjusted  429.    185.  
#> Adjusted    409.07   50.16
E1 <- estimateit(W1, nodegree, lalonde)
#> Warning in eval(family$initialize): non-integer #successes in a binomial glm!
E1
#> $Outcome_model
#> Independent Sampling design (with replacement)
#> survey::svydesign(id = ~1, data = df, weights = df$w)
#> 
#> Call:  svyglm(formula = Y ~ treat, design = out_model_ds, family = binomial)
#> 
#> Coefficients:
#> (Intercept)        treat  
#>     0.41404      0.09675  
#> 
#> Degrees of Freedom: 613 Total (i.e. Null);  612 Residual
#> Null Deviance:       819 
#> Residual Deviance: 818.6     AIC: 968.9
#> 
#> $Control
#>            nlcon     SE
#> contrast 0.60206 0.0242
#> 
#> $Treated
#>            nlcon     SE
#> contrast 0.62499 0.0819
#> 
#> $D
#>             nlcon     SE
#> contrast 0.022935 0.0854
#> 
#> $logRR
#>             nlcon    SE
#> contrast 0.037387 0.137
#> 
#> $logOR
#>             nlcon     SE
#> contrast 0.096748 0.3636
#> 
#> $Table
#> # A tibble: 5 x 5
#>   estimand effect  estimate conf.low conf.high
#>   <chr>    <chr>      <dbl>    <dbl>     <dbl>
#> 1 ATE      Control   0.602     0.555     0.649
#> 2 ATE      Treated   0.625     0.465     0.785
#> 3 ATE      D         0.0229   -0.144     0.190
#> 4 ATE      RR        1.04      0.794     1.36 
#> 5 ATE      OR        1.10      0.540     2.25

## get all estimands

WS <-map(list(ATE="ATE", ATT="ATT", ATC="ATC", AT0="ATO", ATM="ATM", ATOS="ATOS"),
    ~weightit(formula = treat ~ age + educ + married +
                 re74, data = lalonde,  method = "ps", estimand = .x))

ES <- map(WS, ~estimateit(.x, nodegree, lalonde))
#> Warning in eval(family$initialize): non-integer #successes in a binomial glm!

#> Warning in eval(family$initialize): non-integer #successes in a binomial glm!

#> Warning in eval(family$initialize): non-integer #successes in a binomial glm!

#> Warning in eval(family$initialize): non-integer #successes in a binomial glm!

#> Warning in eval(family$initialize): non-integer #successes in a binomial glm!

#> Warning in eval(family$initialize): non-integer #successes in a binomial glm!

all_estimands <- map(ES, ~.x$table) %>%
  map_dfr(~.x, .id="Estimand")
all_estimands
#> # A tibble: 0 x 0
```
